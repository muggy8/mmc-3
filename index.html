<html>
	<head>
		<title>Music Matrix Composer V3</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<meta charset="UTF-8">

		<!-- basic styles -->
		<link href="/app/css/critical.css" rel="stylesheet"/>
	</head>
	<body>
		<header class="fixed col-2-2" style="top: 0;">
            <div class="flex-big vhcenter wrap bg-primary">
                <h1 class="text-center cell">
                    Music Matrix Composer (V3)
                </h1>
                <div class="hide block-big grow"></div>
                <nav class="flex hcenter vend-big">
                    <div
                        class="cell bg-primary-dark-hover {:
                            (this.app.nav.subNavSection === 'login') ? 'bg-primary-dark' : ''
                        :}|{nav.subNavSection}| {: this.app.user.name.toString() && ' hidden-state ':}|{user.name}|"
                        onclick="(this.app.nav.subNavSection === 'login') ? (this.app.nav.subNavSection = '') : (this.app.nav.subNavSection = 'login')"
                    >Login</div>
                    <div
                        class="cell bg-primary-dark-hover {:
                            (this.app.nav.subNavSection === 'account') ? 'bg-primary-dark' : ''
                        :}|{nav.subNavSection}| {: !this.app.user.name.toString() && ' hidden-state ':}|{user.name}|"
                        onclick="(this.app.nav.subNavSection === 'account') ? (this.app.nav.subNavSection = '') : (this.app.nav.subNavSection = 'account')"
                    >Account</div>
                    <div
                        class="cell bg-primary-dark-hover {: !this.app.user.name.toString() && ' hidden-state ':}|{user.name}|"
                        onclick="this.app.nav.logout()"
                    >LogOut</div>
                </nav>
            </div>

            <!-- sub menu -->
            <div class="absolute-big col-1-6-big bg-primary-dark text-center {: this.app.nav.subNavSection.toString() ? '' : ' hidden-state ' :}|{nav.subNavSection}|" style="top: 100%; right:0;">

				<!-- Login with ... -->
				<div class="{: (this.app.nav.subNavSection === 'login') ? '' : ' hidden-state ' :}|{nav.subNavSection}| cell">
					Login With
                    <a href="/api/auth/reddit" target="_blank" class="block color-gray-light color-white-hover bg-primary-light-hover">Reddit</a>
                </div>

				<!-- my account -->
				<form class="{: (this.app.nav.subNavSection === 'account') ? '' : ' hidden-state ' :}|{nav.subNavSection}| flex-mid vhcenter block-big" onsubmit="this.app.nav.patchUser(this.app.sendUser); this.app.sendUser = {}; return false;">
					<label class="block cell text-left-big">
						Name: <input type="text" name="user.name" class="bg-gray col-2-2-big" onblur="this.app.sendUser.name = this.app.user.name.toString()" required>
					</label>
					<label class="block cell text-left-big">
						Email (public): <input type="email" name="user.email" class="bg-gray col-2-2-big" onblur="this.app.sendUser.email = this.app.user.email.toString()">
					</label>
					<label class="block cell text-left-big">
						Website (public): <input type="url" name="user.website" class="bg-gray col-2-2-big" onblur="this.app.sendUser.website = this.app.user.website.toString()">
					</label>
					<label class="block cell text-center text-right-big">
						<button type="submit" class="bubble-0.25 padding-0.25em bg-gray-light">Save</button>
					</label>
				</form>
            </div>

		</header>
		<div style="height: {:
			this.previousElementSibling.offsetHeight
		:}|{nav.subNavSection},{screenSize}|px"></div>
		<main class="relative"></main>
        <div id="loading" class="hidden-state break-point" data-script="{:
			this.app.mediaState = window.getComputedStyle(this, ':before').getPropertyValue('content').replace(new RegExp('\\\W', 'g'), '')
		:}|{screenSize}|"></div>


		<!-- our debugger for mobile debugging -->
		<script>document.location.hash.match(/debug/) && document.write('<script src="//unpkg.com/mobile-inspector">\<\/script\>')</script>

		<!-- font loading -->
		<script src="https://cdn.rawgit.com/bramstein/fontfaceobserver/111670b895c338bed371ad5feb95d8573ce3d0c9/fontfaceobserver.standalone.js"></script>
		<script>
			new FontFaceObserver("Source Sans Pro")
				.load()
				.then(function(){
					document.body.className += " has-font"
				}, function(o3o){
					console.warn("Failed to load font: Source Sans Pro", o3o)
				})
		</script>

		<!-- our main UI and what not dependencies -->
		<script src="https://cdn.rawgit.com/muggy8/proxymity/5d32996a9c73c6f9bb2fe3713817ecd587f90e2e/dist/proxymity.min.js"></script>
		<script src="https://cdn.rawgit.com/muggy8/chainify/78236dde2fb5766ecb7436c86cd0b6388691bc74/chainify.min.js"></script>
		<!-- <script src="//unpkg.com/aja@0.4.1/aja.min.js"></script> -->
		<script src="//unpkg.com/jsmidgen@0.1.5/lib/jsmidgen.js"></script>
		<script src="//cdn.rawgit.com/danigb/soundfont-player/8c16480ff9b5101531da16516b3df10366c56c00/dist/soundfont-player.min.js"></script>
		<script src="//unpkg.com/midi-player-js@2.0.3/browser/midiplayer.min.js"></script>

		<!-- This is our app -->
		<!-- <script src="/app/js/"></script> -->
        <script>
            new (chainify(XMLHttpRequest))()
                .open("GET", "/app/assets.json")
                .addEventListener("load", function(){

                    Promise.all(
						JSON.parse(this.responseText).js.map(function(path){
	                        return new Promise(function(accept, reject) {
								var xhr = new XMLHttpRequest()
								xhr.addEventListener("load", function(){
									accept(xhr)
								})
								xhr.addEventListener("error", function(){
									reject(xhr)
								})
								xhr.open("GET", path)
								xhr.send()
							})
	                    })
					).then(function(set){
						var s = document.createElement("script")
						s.innerHTML = set.reduce(function(sum, xhr){
							return sum + xhr.responseText
						}, "")
						document.body.appendChild(s)
					}, function(set){
						alert("Failed to load app. Please refresh the page at a later time.")
					})

                })
                .addEventListener("error", function(){
                    alert("failed to load app")
                })
                .send()
        </script>

		<!-- This is our main stylings  -->
		<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
		<link href="/app/css/icons.css" rel="stylesheet"/>
		<link href="/app/css/styles.css" rel="stylesheet"/>
	</body>
</html>
